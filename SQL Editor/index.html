<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SQL Online Editor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/sql-wasm.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
      transition: background-color 0.3s, color 0.3s;
    }

    /* Dark Mode */
    body {
      background-color: #1A1A1D;
      color: #F0E6EF;
    }

    /* Light Mode */
    body.light-mode {
      background-color: #f5f6f8;
      color: #1f2937;
    }

    header {
      background-color: #1A1A1D;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid #3B1C32;
    }

    body.light-mode header {
      background-color: #ffffff;
      border-bottom: 1px solid #e2e8f0;
    }

    .logo {
      font-size: 1.4em;
      font-weight: bold;
      color: #4D79A6;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.light-mode .logo {
      color: #3b82f6;
    }

    .logo-img {
      height: 32px;
      width: 32px;
    }

    .lang-buttons {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .lang-buttons button {
      background-color: #2A2A2E;
      color: #F0E6EF;
      border: 1px solid #3B1C32;
      padding: 6px 12px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 13px;
      border: 1px solid #1E556A;
    }

    body.light-mode .lang-buttons button {
      background-color: #ffffff;
      color: #4b5563;
      border: 1px solid #2563eb;
    }

    .lang-buttons button:hover {
      background-color: #1E556A;
      color: #FFFFFF;
      border: 1px solid #4D79A6;
    }

    body.light-mode .lang-buttons button:hover {
      background-color: #e0f2fe;
      color: #2563eb;
      border: 1px solid #3b82f6;
    }

    .container {
      display: flex;
      height: calc(100vh - 70px);
      width: 100%;
    }

    .panel, .output-panel {
      height: 100%;
      display: flex;
      flex-direction: column;
      background-color: #242428;
      overflow: hidden;
    }

    body.light-mode .panel,
    body.light-mode .output-panel {
      background-color: #ffffff;
      border: 1px solid #e2e8f0;
    }

    .panel {
      width: 50%;
      border-right: 1px solid #1E556A;
    }

    body.light-mode .panel {
      border-right: 1px solid #e2e8f0;
    }

    .output-panel {
      width: 50%;
      background-color: #242428;
    }

    body.light-mode .output-panel {
      background-color: #ffffff;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #2A2A2E;
      height: 45px;
      border-bottom: 1px solid #1E556A;
    }

    body.light-mode .top-bar {
      background-color: #f5f6f8;
      border-bottom: 1px solid #e2e8f0;
    }

    .file-label {
      color: #4D79A6;
      font-weight: bold;
      font-size: 14px;
    }

    body.light-mode .file-label {
      color: #2563eb;
    }

    .button-group button {
      padding: 4px 10px;
      font-size: 13px;
      border-radius: 40px;
      border: none;
      margin-left: 5px;
      cursor: pointer;
    }

    /* Dark mode buttons */
    .run { background-color: #1E556A; color: #ffffff; }
    .copy { background-color: #1E556A; color: #ffffff; }
    .clear { background-color: #1E556A; color: #ffffff; }

    /* Light mode buttons */
    body.light-mode .run { background-color: #3b82f6; color: rgb(255, 255, 255); }
    body.light-mode .copy { background-color: #3b82f6; color: #ffffff; }
    body.light-mode .clear { background-color: #3b82f6; color: #ffffff; border: 1px solid #e2e8f0; }

    .editor, .output-area {
      flex-grow: 1;
      padding: 10px;
      background-color: #242428;
      color: #F0E6EF;
      font-size: 16px;
      border: none;
      outline: none;
      resize: none;
    }

    body.light-mode .editor,
    body.light-mode .output-area {
      background-color: #ffffff;
      color: #1f2937;
      border: 1px solid #e2e8f0;
    }

    pre.output-area {
      white-space: pre-wrap;
    }

    /* Vertical Resizer */
    .resizer {
      width: 2px;
      background: #1E556A;
      cursor: col-resize;
    }

    body.light-mode .resizer {
      background: #e2e8f0;
    }

    .resizer:hover {
      background: #4D79A6;
    }

    body.light-mode .resizer:hover {
      background: #3b82f6;
    }

    .toggle-icon {
      width: 30px;
      height: 30px;
      cursor: pointer;
      object-fit: contain;
      transition: transform 0.2s;
    }

    .toggle-icon:hover {
      transform: scale(1.1);
    }

    .lang-icon {
      width: 16px;
      height: 16px;
      margin-right: 6px;
      vertical-align: middle;
    }

    .lang-buttons button {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 6px 10px 6px 8px;
    }

    .lang-buttons button {
      background-color: #2A2A2E;
      color: #F0E6EF;
      border: 1px solid #1E556A;
      padding: 6px 8px;
      cursor: pointer;
      border-radius: 4px;
      font-size: 13px;
      border: 1px solid #1E556A;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    /* Table styling for SQL results */
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }

    th, td {
      border: 1px solid #4D79A6;
      padding: 8px;
      text-align: left;
    }

    body.light-mode th, body.light-mode td {
      border: 1px solid #3b82f6;
    }

    th {
      background-color: #1E556A;
      color: white;
    }

    body.light-mode th {
      background-color: #3b82f6;
    }

    tr:nth-child(even) {
      background-color: #2A2A2E;
    }

    body.light-mode tr:nth-child(even) {
      background-color: #f5f6f8;
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">
        <img src="/TryCode Editor/Attachments/logo.png" alt="SQL Editor Logo" class="logo-img">
        <span>SQL Editor</span>
    </div>
    <div class="lang-buttons">
      <button onclick="alert('HTML/CSS/JS support coming soon!')">
        <img src="/TryCode Editor/Attachments/htmlcssjs.png" class="lang-icon">
        HTML/CSS/JS
      </button>
      <button onclick="alert('Python support coming soon!')">
        <img src="/TryCode Editor/Attachments/python.png" class="lang-icon">
        Python
      </button>
      <button onclick="alert('JavaScript support coming soon!')">
        <img src="/TryCode Editor/Attachments/javascript.png" class="lang-icon">
        JavaScript
      </button>
      <button onclick="setActiveLanguage('sql')">
        <img src="/TryCode Editor/Attachments/sql.png" class="lang-icon">
        SQL
      </button>
      <img id="darkModeToggle" src="/TryCode Editor/Attachments/sun.png" alt="Toggle Dark Mode" class="toggle-icon">
    </div>
  </header><hr>

  <div class="container">
    <!-- Code Panel -->
    <div class="panel" id="codePanel">
      <div class="top-bar">
        <div class="file-label">query.sql</div>
        <div class="button-group">
          <button class="run" onclick="runSQL()">Run</button>
          <button class="copy" onclick="copyCode()">Copy</button>
        </div>
      </div>
      <textarea id="code" class="editor" spellcheck="false" placeholder="-- Write SQL queries here...&#10;-- Example: SELECT * FROM employees;&#10;-- Multiple statements are supported"></textarea>
    </div>

    <!-- Resizer Divider -->
    <div class="resizer" id="dragbar"></div>

    <!-- Output Panel -->
    <div class="output-panel" id="outputPanel">
        <div class="top-bar">
            <div class="button-group">
              <button class="clear" onclick="clearOutput()">Clear</button>
              <button class="run" onclick="initSampleDatabase()">Load Sample DB</button>
            </div>
            <div class="file-label">Results</div>
        </div>
        <div id="output" class="output-area">&gt;</div>
    </div>
  </div>
  <script>
    let db = null;
    let sqlReady = false;
    
    // Initialize SQL.js
    function initSQL() {
      const config = {
        locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${filename}`
      };
      
      initSqlJs(config).then(function(SQL) {
        // Create a new database
        db = new SQL.Database();
        sqlReady = true;
        console.log("SQL.js initialized");
        
        // Initialize with a sample database
        initSampleDatabase();
      }).catch(function(err) {
        console.error("Error loading SQL.js:", err);
        document.getElementById("output").innerHTML = "Error loading SQL engine: " + err.message;
      });
    }
    
    // Initialize with a sample database
    function initSampleDatabase() {
      if (!sqlReady) {
        alert("SQL engine is still loading...");
        return;
      }
      
      try {
        // Clear existing database
        db.close();
        const config = {
          locateFile: filename => `https://cdnjs.cloudflare.com/ajax/libs/sql.js/1.8.0/${filename}`
        };
        
        initSqlJs(config).then(function(SQL) {
          db = new SQL.Database();
          
          // Create sample tables
          db.run(`
            CREATE TABLE employees (
              id INTEGER PRIMARY KEY,
              name TEXT,
              department TEXT,
              salary REAL,
              hire_date TEXT
            );
            
            CREATE TABLE departments (
              id INTEGER PRIMARY KEY,
              name TEXT,
              location TEXT,
              budget REAL
            );
            
            INSERT INTO departments VALUES 
              (1, 'Engineering', 'Floor 1', 1000000),
              (2, 'Marketing', 'Floor 2', 500000),
              (3, 'Sales', 'Floor 3', 750000),
              (4, 'HR', 'Floor 4', 300000);
              
            INSERT INTO employees VALUES 
              (1, 'John Doe', 'Engineering', 85000, '2020-01-15'),
              (2, 'Jane Smith', 'Marketing', 75000, '2019-05-22'),
              (3, 'Mike Johnson', 'Engineering', 92000, '2018-11-03'),
              (4, 'Sarah Williams', 'Sales', 68000, '2021-02-14'),
              (5, 'David Brown', 'HR', 65000, '2020-07-30'),
              (6, 'Emily Davis', 'Engineering', 88000, '2019-09-10'),
              (7, 'Robert Wilson', 'Marketing', 72000, '2021-01-05'),
              (8, 'Lisa Taylor', 'Sales', 70000, '2018-03-18');
          `);
          
          document.getElementById("output").innerHTML = "✓ Sample database loaded with:<br>" +
            "- employees table (8 records)<br>" +
            "- departments table (4 records)";
        });
      } catch (err) {
        document.getElementById("output").innerHTML = "Error initializing sample database: " + err.message;
      }
    }
    
    // Execute SQL queries
    function runSQL() {
      if (!sqlReady) {
        alert("SQL engine is still loading...");
        return;
      }
      
      const sql = document.getElementById("code").value;
      
      try {
        let output = "";
        const results = db.exec(sql); // returns an array of results
        
        if (results.length === 0) {
          output = "✓ Query executed successfully (no results to display)";
        } else {
          results.forEach(result => {
            if (result.columns && result.values) {
              // Create a table for the results
              output += "<table><thead><tr>";
              
              // Add column headers
              result.columns.forEach(col => {
                output += `<th>${col}</th>`;
              });
              
              output += "</tr></thead><tbody>";
              
              // Add rows
              result.values.forEach(row => {
                output += "<tr>";
                row.forEach(cell => {
                  output += `<td>${cell !== null ? cell : "NULL"}</td>`;
                });
                output += "</tr>";
              });
              
              output += "</tbody></table>";
            }
          });
        }
        
        document.getElementById("output").innerHTML = output || "✓ Query executed successfully";
      } catch (err) {
        document.getElementById("output").innerHTML = "SQL Error: " + err.message;
      }
    }
    
    function copyCode() {
      const code = document.getElementById("code");
      if (navigator.clipboard && window.isSecureContext) {
        navigator.clipboard.writeText(code.value)
        .then(() => alert("Code copied!"))
        .catch(err => alert("Failed to copy code: " + err));
      } else {
        code.select();
        try {
          const successful = document.execCommand('copy');
          alert(successful ? "Code copied!" : "Copy failed");
        } catch (err) {
          alert("Copy not supported: " + err);
        }
      }
    }
    
    function clearOutput() {
      document.getElementById("output").innerHTML = ">";
    }
    
    // Resizer Functionality
    const dragbar = document.getElementById("dragbar");
    const leftPanel = document.getElementById("codePanel");
    const rightPanel = document.getElementById("outputPanel");
    let dragging = false;
    
    dragbar.addEventListener("mousedown", function (e) {
      e.preventDefault();
      dragging = true;
      document.body.style.cursor = "col-resize";
    });
    
    window.addEventListener("mousemove", function (e) {
      if (!dragging) return;
      const containerWidth = document.querySelector(".container").offsetWidth;
      const leftWidth = e.clientX;
      const rightWidth = containerWidth - leftWidth - dragbar.offsetWidth;
      
      if (leftWidth < 100 || rightWidth < 100) return;
      
      leftPanel.style.width = `${leftWidth}px`;
      rightPanel.style.width = `${rightWidth}px`;
    });
    
    window.addEventListener("mouseup", function () {
      dragging = false;
      document.body.style.cursor = "default";
    });
    
    // Dark/Light Mode Toggle
    const toggle = document.getElementById('darkModeToggle');
    const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    
    // Set initial theme
    const currentTheme = localStorage.getItem('theme') || 
                       (prefersDarkScheme.matches ? 'dark' : 'light');
    
    if (currentTheme === 'light') {
      document.body.classList.add('light-mode');
      toggle.src = "/TryCode Editor/Attachments/moon.png";
    }
    
    // Toggle functionality
    toggle.addEventListener('click', () => {
      const isLight = document.body.classList.toggle('light-mode');
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
      toggle.src = isLight ? "/TryCode Editor/Attachments/moon.png" 
                          : "/TryCode Editor/Attachments/sun.png";
    });
    
    // Watch for system theme changes
    prefersDarkScheme.addListener(e => {
      const newTheme = e.matches ? 'dark' : 'light';
      document.body.classList.toggle('light-mode', !e.matches);
      localStorage.setItem('theme', newTheme);
      toggle.src = e.matches ? "/TryCode Editor/Attachments/sun.png" 
                            : "/TryCode Editor/Attachments/moon.png";
    });
    
    // Initialize SQL.js when page loads
    window.onload = initSQL;
  </script>
</body>
</html>