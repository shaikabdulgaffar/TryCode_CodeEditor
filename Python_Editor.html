<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Online Compiler</title>
  <script src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Courier New', monospace;
    }

    body {
      background-color: #1e1e2e;
      color: #eee;
    }

    header {
      background-color: #111;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .logo {
      font-size: 1.4em;
      font-weight: bold;
      color: #4fc3f7;
    }

    .lang-buttons button {
      background-color: #333;
      color: #eee;
      border: none;
      padding: 6px 12px;
      margin: 0 5px;
      cursor: pointer;
      border-radius: 4px;
    }

    .lang-buttons button:hover {
      background-color: #555;
    }

    .container {
      display: flex;
      height: calc(100vh - 70px);
      width: 100%;
    }

    .panel, .output-panel {
      height: 100%;
      display: flex;
      flex-direction: column;
      background-color: #282c34;
      overflow: hidden;
    }

    .panel {
      width: 50%;
      border-right: 1px solid #333;
    }

    .output-panel {
      width: 50%;
      background-color: #1a1c23;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 12px;
      background-color: #1c1c1c;
      height: 45px;
      border-bottom: 1px solid #444;
    }

    .file-label {
      color: #00d8ff;
      font-weight: bold;
      font-size: 14px;
    }

    .button-group button {
      padding: 4px 10px;
      font-size: 13px;
      border-radius: 4px;
      border: none;
      margin-left: 5px;
      cursor: pointer;
    }

    .run { background-color: #4caf50; color: white; }
    .copy { background-color: #2196f3; color: white; }
    .clear { background-color: #f44336; color: white; }

    .editor, .output-area {
      flex-grow: 1;
      padding: 10px;
      background-color: #282c34;
      color: #fff;
      font-size: 16px;
      border: none;
      outline: none;
      resize: none;
    }

    pre.output-area {
      white-space: pre-wrap;
    }

    /* Vertical Resizer */
    .resizer {
      width: 2px;
      background: #ffffff;
      cursor: col-resize;
    }

    .resizer:hover {
      background: #ffffff;
    }

    .logo {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .logo-img {
        height: 32px;
        width: 32px;
    }
  </style>
</head>
<body>

  <header>
    <div class="logo">
        <img src="logo.png" alt="TryCode Logo" class="logo-img">
        <span>TryCode Compiler</span>
    </div>
    <div class="lang-buttons">
      <button onclick="alert('html, css & js support coming soon!')">HTML, CSS & JS</button>
      <button onclick="alert('Only Python is supported currently')">Python</button>
      <button onclick="alert('Java support coming soon!')">JavaScript</button>
      <button onclick="alert('Java support coming soon!')">Java</button>
      <button onclick="alert('C/C++ support coming soon!')">C/C++</button>
      <button onclick="alert('SQL support coming soon!')">SQL</button>
    </div>
  </header><hr>

  <div class="container">
    <!-- Code Panel -->
    <div class="panel" id="codePanel">
      <div class="top-bar">
        <div class="file-label">Main.py</div>
        <div class="button-group">
          <button class="run" onclick="runCode()">Run</button>
          <button class="copy" onclick="copyCode()">Copy</button>
        </div>
      </div>
      <textarea id="code" class="editor" spellcheck="false" placeholder="# Write Python code here..."></textarea>
    </div>

    <!-- Resizer Divider -->
    <div class="resizer" id="dragbar"></div>

    <!-- Output Panel -->
    <div class="output-panel" id="outputPanel">
        <div class="top-bar">
            <div class="button-group">
            <button class="clear" onclick="clearOutput()">Clear</button>
            </div>
            <div class="file-label">Output</div>
        </div>
        <pre id="output" class="output-area">&gt;</pre>
    </div>


  <script>
    let pyodideReady = false;
    let pyodide;

    async function loadPyodideAndPackages() {
      pyodide = await loadPyodide();
      pyodideReady = true;
      console.log("Pyodide loaded.");
    }
    loadPyodideAndPackages();

    async function runCode() {
        if (!pyodideReady) {
            alert("Python is still loading...");
            return;
        }

        const code = document.getElementById("code").value;

        // Capture stdout using Pyodide's `pyodide.runPythonAsync`
        try {
            let outputArea = document.getElementById("output");
            // Redirect stdout to capture print statements
            pyodide.runPython(`
        import sys
        import io
        sys.stdout = io.StringIO()
        sys.stderr = sys.stdout
            `);

            await pyodide.runPythonAsync(code);

            const result = pyodide.runPython("sys.stdout.getvalue()");
            outputArea.textContent = result || "Code executed.";
        } catch (err) {
            document.getElementById("output").textContent = String(err);
        }
    }


    function copyCode() {
        const code = document.getElementById("code");
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(code.value)
            .then(() => alert("Code copied!"))
            .catch(err => alert("Failed to copy code: " + err));
        } else {
            // Fallback for insecure context
            code.select();
            try {
            const successful = document.execCommand('copy');
            alert(successful ? "Code copied!" : "Copy failed");
            } catch (err) {
            alert("Copy not supported: " + err);
            }
        }
    }



    function clearOutput() {
        document.getElementById("output").textContent = ">";
    }


    // Resizer Functionality
    const dragbar = document.getElementById("dragbar");
    const leftPanel = document.getElementById("codePanel");
    const rightPanel = document.getElementById("outputPanel");
    let dragging = false;

    dragbar.addEventListener("mousedown", function (e) {
      e.preventDefault();
      dragging = true;
      document.body.style.cursor = "col-resize";
    });

    window.addEventListener("mousemove", function (e) {
      if (!dragging) return;
      const containerWidth = document.querySelector(".container").offsetWidth;
      const leftWidth = e.clientX;
      const rightWidth = containerWidth - leftWidth - dragbar.offsetWidth;

      if (leftWidth < 100 || rightWidth < 100) return; // minimum width

      leftPanel.style.width = `${leftWidth}px`;
      rightPanel.style.width = `${rightWidth}px`;
    });

    window.addEventListener("mouseup", function () {
      dragging = false;
      document.body.style.cursor = "default";
    });
  </script>

</body>
</html>